generator client {
  provider = "prisma-client-js"
  output = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Session {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name      String    @unique
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  sales     Sale[]

  @@map("sessions")
}

model Category {
  id       Int       @id @default(autoincrement())
  name     String    @unique
  products Product[]

  @@map("categories")
}

model Product {
  id         Int        @id @default(autoincrement())
  categoryId Int?       @map("category_id")
  name       String
  price      Decimal    @db.Decimal(12, 2)
  currency   String
  active     Boolean?   @default(true)
  created_at DateTime?  @default(now()) @db.Timestamptz(6)
  category   Category?  @relation(fields: [categoryId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  saleItems  SaleItem[]

  @@map("products")
}

model PaymentMethod {
  id       Int           @id @default(autoincrement())
  name     String        @unique
  currency String
  payments SalePayment[]

  @@map("payment_methods")
}

model Sale {
  id        String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  sessionId String?       @map("session_id") @db.Uuid
  totalUsd  Decimal       @map("total_usd") @db.Decimal(12, 2)
  totalBs   Decimal       @map("total_bs") @db.Decimal(12, 2)
  tasaBcv   Decimal       @map("tasa_bcv") @db.Decimal(12, 4)
  createdAt DateTime?     @default(now()) @map("created_at") @db.Timestamptz(6)
  items     SaleItem[]
  payments  SalePayment[]
  session   Session?      @relation(fields: [sessionId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("sales")
}

model SaleItem {
  id            Int      @id @default(autoincrement())
  saleId        String?  @map("sale_id") @db.Uuid
  productId     Int?     @map("product_id")
  quantity      Int
  priceAtMoment Decimal  @map("price_at_moment") @db.Decimal(12, 2)
  product       Product? @relation(fields: [productId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  sale          Sale?    @relation(fields: [saleId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("sale_items")
}

model SalePayment {
  id        Int            @id @default(autoincrement())
  saleId    String?        @map("sale_id") @db.Uuid
  methodId  Int?           @map("method_id")
  amountBs  Decimal        @map("amount_bs") @db.Decimal(12, 2)
  amountRef Decimal        @map("amount_ref") @db.Decimal(12, 2)
  method    PaymentMethod? @relation(fields: [methodId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  sale      Sale?          @relation(fields: [saleId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("sale_payments")
}
